---

copyright:
  years: 2016, 2017
lastupdated: "2017-02-22"
---

{:new_window: target="\_blank"}
{:shortdesc: .shortdesc}
{:screen:.screen}
{:codeblock:.codeblock}
{:pre: .pre}

# 証明書の構成
{: #set_up_certificates}

証明書は、デバイス認証に使用したり、MQTT メッセージング用の {{site.data.keyword.iot_full}} のデフォルトのサーバー証明書を置き換えるために使用したりします。署名付きの有効な証明書のないデバイスは、アクセスを拒否され、サーバーと通信できません。

デバイスの証明書やサーバーへのアクセスを構成するには、システム・オペレーターが、関連する認証局 (CA) 証明書とオプションでメッセージ・サーバー証明書を {{site.data.keyword.iot_short_notm}} プラットフォームに登録します。

## 証明書の要件
{: #cert_reqs}

### CA 証明書
CA 証明書を使用すると、組織は、デバイス上のクライアント証明書を信頼されたものとして認識できるので、デバイスをサーバーに接続できます。CA 証明書では、証明書失効リスト (CRL) を使用できます。CRL には、CA がプラットフォームに追加された時点でアクセスできなければなりません。そうしないと、CA 証明書は拒否されます。

CA 証明書を追加したり、メッセージング・サーバー証明書を置き換えたりする場合は、サーバーが適切な CA を使用してデバイスを認証できるように、すべてのデバイスが、サーバー名表示 (SNI) をサポートする MQTT クライアントを使用して接続している必要があります。

標準セキュリティー・プランを利用している場合に CA 証明書を追加すると、すべてのデバイスの接続に「TLS とトークン認証とクライアント証明書認証」接続ポリシーが使用されます。無料セキュリティー・プランまたは拡張セキュリティー・プランを利用する場合は、さまざまな接続ポリシーを構成できます。接続セキュリティー・ポリシーを構成する方法については、[セキュリティー・ポリシーの構成](set_up_policies.html)を参照してください。

### クライアントまたはデバイスの証明書
個々のクライアント証明書またはデバイス証明書はデバイス上に残り、プラットフォームにはアップロードされません。すべてのデバイス証明書への署名に使用される CA 署名証明書は、プラットフォームにアップロードする唯一の証明書です。自己署名サーバー証明書を使用する場合は、クライアント証明書 (cert.pem) の署名に使用するルート証明書と中間証明書をアップロードする必要があります。

CA 証明書を使用して署名する個々のデバイス証明書には、デバイス ID が共通名 (CN) または SubjectAltName として入力されている必要があります。*CN* フィールドの形式は「CN=d:devtype:devid」です。SubjectAltName フィールドの形式は「SubjectAltName=email:d:*devtype:devid*」です。「email:d」は定数、「*devtype*」はデバイスのデバイス・タイプ、「*devid*」はデバイスのクライアント ID です。

## デバイス認証のための認証局 (CA) 証明書の登録
{: #reg_ca_cert}

1. {{site.data.keyword.iot_short_notm}} にログインし、**「一般設定」**にナビゲートします。
2. **「セキュリティー」**セクションの**「CA 証明書」**で**「証明書の追加」**をクリックします。
3. 「参照」をクリックして、アップロードする証明書ファイルを選択するか、**「証明書の追加」**ウィンドウにファイルをドラッグ・アンド・ドロップします。そのファイルは、証明書が 1 つだけ入っているファイルでなければならず、証明書の日付が有効でなければなりません。受け入れられる証明書の形式は、.pem または .der だけです。選択したファイルに入っている証明書の情報をプレビューすることもできます。
4. 証明書ファイルの説明を入力します。
5. 正しいファイルを選択したことを確認して、**「保存」**をクリックします。選択した証明書がテーブルにリストされ、デフォルトでアクティブになります。

## メッセージング・サーバー証明書の登録
{: #reg_msg_cert}

プラットフォームには、デフォルトのサーバー証明書が用意されています。デフォルトの証明書を使用することも、組織の証明書をアップロードすることもできます。使用する証明書がない場合は、新しい証明書の要求を作成できます。新しい証明書を受け取ったら、署名を付けてからプラットフォームにアップロードしなければなりません。

デフォルトの証明書または既にアップロードした別の証明書を使用するには、**「メッセージング・サーバー証明書」**の下にあるテーブルの**「デフォルトのメッセージング・サーバー証明書」**ドロップダウン・リストから、使用する証明書を選択します。

**注:** プラットフォームのダッシュボード・ページでは、デバイス情報を取得するためにメッセージング・サーバーへの内部接続が行われる場合があります。組織向けの自己署名サーバー証明書を設定する場合、ダッシュボード・ユーザーは、接続の問題を回避するために、信頼された証明書として証明書をブラウザーに追加する必要があります。これは、デフォルトでは、ブラウザーで、メッセージング・サーバーが信頼されるサーバーとして認識されないためです。

### 組織の証明書のアップロード
{: #upload_cert}
1. **「一般設定」**の**「セキュリティー」**セクションにある**「メッセージング・サーバー証明書」**で**「証明書の追加」**をクリックします。
2. 「参照」をクリックして、アップロードする証明書ファイルを選択するか、**「証明書の追加」**ウィンドウにファイルをドラッグ・アンド・ドロップします。
3. 「参照」をクリックして、アップロードする秘密鍵ファイルを選択するか、**「証明書の追加」**ウィンドウにファイルをドラッグ・アンド・ドロップします。  
4. 秘密鍵がパスフレーズで暗号化されている場合は、そのパスフレーズを入力します。
5. 正しいファイルを選択したことを確認して、**「保存」**をクリックします。
6. **「デフォルトのメッセージング・サーバー証明書」**ドロップダウン・リストから、アップロードした新しい証明書を選択します。選択した証明書がアクティブな証明書としてテーブルにリストされます。

### 新しい証明書の要求
{: #request_cert}

新しいメッセージング・サーバー証明書を使用する場合は、証明書署名要求 (CSR) を生成して新しい証明書を要求できます。

 1. **「一般設定」**の**「セキュリティー」**セクションにある**「メッセージング・サーバー証明書」**で**「CSR の生成」**をクリックします。
 2. サーバーに対して CSR を要求するための詳細情報を入力して、**「生成」**をクリックします。CSR がテーブルに表示されます。
 3. 要求をダウンロードして、署名を得るために認証局に送信します。
 4. 証明書を取得したら、テーブルの CSR エントリーに戻り、新しい証明書をアップロードします。証明書をアップロードすると、テーブル内の CSR が、アップロードした証明書に置き換わります。
